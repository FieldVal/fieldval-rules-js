function extend(e,i){function r(){}r.prototype=i.prototype,e.prototype=new r,e.prototype.constructor=e,e.superConstructor=i,e.superClass=i.prototype}"undefined"!=typeof module&&(module.exports=extend);var FVRuleField=function(){function e(e,i){var l=this;if(l.json=e,l.checks=[],l.validator="undefined"!=typeof i?i:new r(e),l.name=l.validator.get("name",t.string(!1)),l.display_name=l.validator.get("display_name",t.string(!1)),l.description=l.validator.get("description",t.string(!1)),l.type=l.validator.get("type",t.string(!0)),l.required=l.validator.get("required",t["boolean"](!1)),void 0===l.required&&(l.required=!0),null!=e){var n=l.validator.get("exists",t["boolean"](!1));null!=n&&(existsFilter=n?1:2)}}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r=i,t=r.BasicVal;return e.types={},e.add_field_type=function(i){e.types[i.name]={display_name:i.display_name,"class":i["class"]}},e.create_field=function(i,l){var n=null,o=t.object(!0).check(i);if(o)return[o,null];var u=new r(i),a=[t.string(!1)];l&&(void 0!==l.need_name&&l.need_name===!0&&a.push(t.string(!0)),void 0!==l.allow_dots&&l.allow_dots===!1&&a.push(t.does_not_contain(["."])),l.existing_names&&a.push(t.not_one_of(l.existing_names,{error:{error:1e3,error_message:"Name already used"}}))),u.get("name",a);var d=u.get("type",t.string(!0),t.one_of(e.types));if(!d)return[u.end(),null];var s=e.types[d],f=s["class"];n=new f(i,u);var c=n.init();return null!=c?[c,null]:[null,n]},e.prototype.validate_as_field=function(e,i){var r=this;i.get_async(e,r.checks)},e.prototype.validate=function(e,i){var t=this;if(!i)throw new Error("No callback specified");return r.use_checks(e,t.checks,{},function(e){i(e)})},e.prototype.make_nested=function(){},e.prototype.init=function(){},e.prototype.remove=function(){},e.prototype.view_mode=function(){},e.prototype.edit_mode=function(){},e.prototype.change_name=function(){},e.prototype.disable=function(){},e.prototype.enable=function(){},e.prototype.focus=function(){},e.prototype.blur=function(){},e.prototype.val=function(){},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVRuleField);var FVBasicRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FVRuleField)i=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");i=require("./FVRuleField")}var r;if(void 0!==this.extend)r=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");r=require("extend")}var t=r,l=i;return t(e,l),e.prototype.init=function(){var e=this;return e.ui_field.init.apply(e.ui_field,arguments)},e.prototype.remove=function(){var e=this;return e.ui_field.remove.apply(e.ui_field,arguments)},e.prototype.in_array=function(){var e=this;return e.ui_field.in_array.apply(e.ui_field,arguments)},e.prototype.in_key_value=function(){var e=this;return e.ui_field.in_key_value.apply(e.ui_field,arguments)},e.prototype.change_name=function(){var e=this;return e.ui_field.change_name.apply(e.ui_field,arguments)},e.prototype.disable=function(){var e=this;return e.ui_field.disable.apply(e.ui_field,arguments)},e.prototype.enable=function(){var e=this;return e.ui_field.enable.apply(e.ui_field,arguments)},e.prototype.name_val=function(){var e=this;return e.ui_field.name_val.apply(e.ui_field,arguments)},e.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},e.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},e.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},e.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVBasicRuleField);var FVTextRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var a=u;return a(e,o),e.prototype.create_ui=function(){var e=this;return e.ui_field=new FVTextField(e.display_name||e.name,{name:e.json.name,display_name:e.json.display_name,type:e.json.ui_type}),e.element=e.ui_field.element,e.ui_field},e.prototype.init=function(){var e=this;return e.checks.push(l.string(e.required)),e.min_length=e.validator.get("min_length",l.integer(!1)),void 0!==e.min_length&&e.checks.push(l.min_length(e.min_length,{stop_on_error:!1})),e.max_length=e.validator.get("max_length",l.integer(!1)),void 0!==e.max_length&&e.checks.push(l.max_length(e.max_length,{stop_on_error:!1})),e.ui_type=e.validator.get("ui_type",l.string(!1),l.one_of(["text","textarea","password"])),e.phrase=e.validator.get("phrase",l.string(!1)),e.equal_to=e.validator.get("equal_to",l.string(!1)),e.ci_equal_to=e.validator.get("ci_equal_to",l.string(!1)),e.prefix=e.validator.get("prefix",l.string(!1)),e.ci_prefix=e.validator.get("ci_prefix",l.string(!1)),e.query=e.validator.get("query",l.string(!1)),e.validator.end()},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVTextRuleField);var FVNumberRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var a=u;return a(e,o),e.prototype.create_ui=function(){var e=this;return e.ui_field=new FVTextField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},e.prototype.init=function(){var e=this;return e.checks.push(l.number(e.required)),e.minimum=e.validator.get("minimum",l.number(!1)),null!=e.minimum&&e.checks.push(l.minimum(e.minimum,{stop_on_error:!1})),e.maximum=e.validator.get("maximum",l.number(!1)),null!=e.maximum&&e.checks.push(l.maximum(e.maximum,{stop_on_error:!1})),e.integer=e.validator.get("integer",l["boolean"](!1)),e.integer&&e.checks.push(l.integer(!1,{stop_on_error:!1})),e.validator.end()},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVNumberRuleField);var FVObjectRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u,a=n;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var d=u;return d(e,o),e.prototype.create_ui=function(e,i){var r=this;if(r.any)if(r.field_type){r.ui_field=new FVKeyValueField(r.display_name||r.name,r.json),r.element=r.ui_field.element,r.ui_field.new_field=function(e){return r.new_field(e)};var t=r.ui_field.remove_field;r.ui_field.remove_field=function(e){for(var i=0;i<r.fields.length;i++)r.fields[i]===e&&r.fields.splice(i,1);return t.call(r.ui_field,e)}}else r.ui_field=new FVTextField(r.display_name||r.name,{type:"textarea"}),r.ui_field.val=function(e){var i=this;if(0===arguments.length){var r=i.input.val();if(0===r.length)return null;try{return JSON.parse(r)}catch(t){console.error("FAILED TO PARSE: ",r)}return r}return i.input.val(JSON.stringify(e,null,4)),i},r.element=r.ui_field.element;else{r.ui_field=i?i:new FVObjectField(r.display_name||r.name,r.json);for(var l in r.fields){var n=r.fields[l],o=n.create_ui(r.ui_field);r.ui_field.add_field(n.name,o)}r.element=r.ui_field.element}return r.ui_field},e.prototype.new_field=function(){var e=this,i=a.create_field(e.field_type.json),r=(i[0],i[1]);return r.create_ui(e.ui_field)},e.prototype.init=function(){var e=this;e.checks.push(l.object(e.required)),e.fields={};var i=e.validator.get("fields",l.array(!1));if(null!=i){for(var r=new t(null),n=0;n<i.length;n++){var o=i[n],u=a.create_field(o,{need_name:!0,existing_names:e.fields}),d=u[0],s=u[1];null==d?e.fields[s.name]=s:r.invalid(n,d)}var f=r.end();null!=f&&e.validator.invalid("fields",f)}return e.any=e.validator.get("any",l["boolean"](!1)),e.any||e.checks.push(function(i,r,l){var n=new t(i);for(var o in e.fields){var u=e.fields[o];u.validate_as_field(o,n)}return n.end(function(e){l(e)})}),e.validator.get("field_type",l.object(!1),{check:function(){return e.any?void 0:FVRule.errors.field_type_without_any()},stop_on_error:!0},function(i){var r=a.create_field(i),l=r[0];return e.field_type=r[1],l?l:void e.checks.push(function(i){var r=new t(i);for(var l in i)i.hasOwnProperty(l)&&e.field_type.validate_as_field(l,r);return r.end()})}),e.validator.end()},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVObjectRuleField);var FVArrayRuleField=function(){function e(i,r){var t=this;e.superConstructor.call(this,i,r),t.rules=[],t.fields=[],t.interval=null,t.interval_offsets=[]}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u,a=n;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var d=u;return d(e,o),e.prototype.create_ui=function(){var e=this;e.ui_field=new FVArrayField(e.display_name||e.name,e.json),e.ui_field.new_field=function(i){return e.new_field(i)};var i=e.ui_field.remove_field;return e.ui_field.remove_field=function(r){for(var t=0;t<e.fields.length;t++)e.fields[t]===r&&e.fields.splice(t,1);return i.call(e.ui_field,r)},e.element=e.ui_field.element,e.ui_field},e.prototype.new_field=function(e){var i=this,r=i.rule_for_index(e);return r.create_ui(i.ui_field)},e.prototype.rule_for_index=function(e){var i=this,r=i.rules[e];if(!r){{var t=i.rule_json_for_index(e),l=a.create_field(t);l[0]}r=l[1],i.rules[e]=r}return r},e.prototype.rule_json_for_index=function(e){var i=this,r=i.indices[e];if(!r&&i.interval){var t=e%i.interval;r=i.interval_offsets[t]}return r||(r=i.indices["*"]),r},e.integer_regex=/^(\d+)$/,e.interval_regex=/^(\d+)n(\+(\d+))?$/,e.prototype.init=function(){var i=this;i.checks.push(l.array(i.required)),i.indices={};var r=i.validator.get("indices",l.object(!1));if(null!=r){var n=new t(null);for(var o in r){var u=r[o],d=a.create_field(u),s=d[0];if(null==s){var f=o.match(e.interval_regex);if(f){var c=f[1],p=f[3]||0;if(i.interval&&c!==i.interval){n.invalid(o,t.create_error(FVRule.errors.interval_conflict,{},c,i.interval));continue}i.interval=c,i.interval_offsets[p]=u}else{var F=o.match(e.integer_regex);if(F){var v=F[1];i.indices[v]=u}else"*"===o?i.indices["*"]=u:n.invalid(o,t.create_error(FVRule.errors.invalid_indices_format,{}))}}else n.invalid(o,s)}var _=n.end();_&&i.validator.invalid("indices",_)}return i.checks.push(function(e){for(var r=new t(e),l=0;l<e.length;l++){var n=i.rule_for_index(l);n.validate_as_field(l,r)}var o=r.end();return o}),i.validator.end()},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVArrayRuleField);var FVChoiceRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var a=u;return a(e,o),e.prototype.create_ui=function(){var e=this;return e.json.choices=e.choices,e.ui_field=new FVChoiceField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},e.prototype.init=function(){var e=this;return e.allow_empty=e.validator.get("allow_empty",l["boolean"](!1)),e.empty_message=e.validator.get("empty_message",l.string(!1)),e.choices=e.validator.get("choices",l.array(!0)),void 0!==e.choices&&e.checks.push(l.one_of(e.choices,{stop_on_error:!1})),e.validator.end()},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVChoiceRuleField);var FVBooleanRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var a=u;return a(e,o),e.prototype.create_ui=function(){var e=this;return e.ui_field=new FVBooleanField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},e.prototype.init=function(){var e=this;return e.checks.push(l["boolean"](e.required)),e.equal_to=e.validator.get("equal_to",l["boolean"](!1)),void 0!==e.equal_to&&e.checks.push(l.equal_to(e.equal_to)),e.validator.end()},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVBooleanRuleField);var FVEmailRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var a=u;return a(e,o),e.prototype.create_ui=function(){var e=this;return e.ui_field=new FVTextField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},e.prototype.init=function(){var e=this;return e.checks.push(l.string(e.required),l.email()),e.validator.end()},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVEmailRuleField);var FVDateRuleField=function(){function e(i,r){e.superConstructor.call(this,i,r)}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}var r,t=i,l=t.BasicVal;if(void 0!==this.FVRuleField)r=this.FVBasicRuleField;else{if("function"!=typeof require)throw new Error("FVBasicRuleField is missing");r=require("./FVBasicRuleField")}var n,o=r;if(void 0!==this.FVRuleField)n=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");n=require("./FVRuleField")}var u;if(void 0!==this.extend)u=this.extend;else{if("function"!=typeof require)throw new Error("extend() is missing");u=require("extend")}var a=u;return a(e,o),e.prototype.create_ui=function(){var e=this;return e.ui_field=new FVDateField(e.display_name||e.name,{name:e.json.name,display_name:e.json.display_name,format:e.date_format}),e.element=e.ui_field.element,e.ui_field},e.prototype.init=function(){var e=this;return console.log(t),console.log(t.DateVal),console.log(e.date_format),e.date_format=e.validator.get("format",l.string(!0),l.date_format({emit:t.DateVal.EMIT_STRING})),void 0!==e.date_format&&e.checks.push(l.date(e.date_format)),e.validator.end()},e.create_editor_ui=function(e,i){i.add_field("format",new FVTextField("Date format")),i.fields.format.val(e.format)},e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVDateRuleField);var FVRule=function(){function e(){}var i;if(void 0!==this.FieldVal)i=this.FieldVal;else{if("function"!=typeof require)throw new Error("FieldVal Rules requires FieldVal");i=require("fieldval")}{var r,t=i;t.BasicVal}if(void 0!==this.FVRuleField)r=this.FVRuleField;else{if("function"!=typeof require)throw new Error("FVRuleField is missing");r=require("./fields/FVRuleField")}var l=r;return e.errors={interval_conflict:function(e,i){return{error:501,error_message:"Only one interval can be used.",interval:e,existing:i}},invalid_indices_format:function(){return{error:502,error_message:"Invalid format for an indices rule."}},field_type_without_any:function(){return{error:503,error_message:"field_type can't be used with setting any to true."}}},e.FVRuleField=l,e.prototype.init=function(e,i){var r=this,t=l.create_field(e,i);return t[0]?t[0]:(r.field=t[1],null)},e.prototype.create_form=function(){var e=this;if(FVForm){var i=new FVForm;return e.field.create_ui(i,i),i}},e.prototype.create_ui=function(){var e=this;return e.field.create_ui()},e.prototype.validate=function(){var e=this;return e.field.validate.apply(e.field,arguments)},e.prototype.check=function(e,i,r){var t=this;t.field.validate(e,function(e){r(e)})},l.add_field_type({name:"text",display_name:"Text","class":"undefined"!=typeof FVTextRuleField?FVTextRuleField:require("./fields/FVTextRuleField")}),l.add_field_type({name:"string",display_name:"String","class":"undefined"!=typeof FVTextRuleField?FVTextRuleField:require("./fields/FVTextRuleField")}),l.add_field_type({name:"boolean",display_name:"Boolean","class":"undefined"!=typeof FVBooleanRuleField?FVBooleanRuleField:require("./fields/FVBooleanRuleField")}),l.add_field_type({name:"number",display_name:"Number","class":"undefined"!=typeof FVNumberRuleField?FVNumberRuleField:require("./fields/FVNumberRuleField")}),l.add_field_type({name:"object",display_name:"Object","class":"undefined"!=typeof FVObjectRuleField?FVObjectRuleField:require("./fields/FVObjectRuleField")}),l.add_field_type({name:"array",display_name:"Array","class":"undefined"!=typeof FVArrayRuleField?FVArrayRuleField:require("./fields/FVArrayRuleField")}),l.add_field_type({name:"choice",display_name:"Choice","class":"undefined"!=typeof FVChoiceRuleField?FVChoiceRuleField:require("./fields/FVChoiceRuleField")}),l.add_field_type({name:"email",display_name:"Email","class":"undefined"!=typeof FVEmailRuleField?FVEmailRuleField:require("./fields/FVEmailRuleField")}),l.add_field_type({name:"date",display_name:"Date","class":"undefined"!=typeof FVDateRuleField?FVDateRuleField:require("./fields/FVDateRuleField")}),e}.call("undefined"!=typeof window?window:null);"undefined"!=typeof module&&(module.exports=FVRule);