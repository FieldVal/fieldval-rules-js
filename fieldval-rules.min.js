function fieldval_rules_extend(e,r){function i(){}i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function TextRuleField(e,r){TextRuleField.superConstructor.call(this,e,r)}function NumberRuleField(e,r){NumberRuleField.superConstructor.call(this,e,r)}function NestedRuleField(e,r){NestedRuleField.superConstructor.call(this,e,r)}function ChoiceRuleField(e,r){ChoiceRuleField.superConstructor.call(this,e,r)}function RuleField(e,r){var i=this;if(i.json=e,i.operators=[],i.validator="undefined"!=typeof r?r:new Validator(e),i.name=i.validator.get("name",BasicVal.string(!1)),i.display_name=i.validator.get("display_name",BasicVal.string(!1)),i.description=i.validator.get("description",BasicVal.string(!1)),i.type=i.validator.get("type",BasicVal.string(!0)),i.required=i.validator.default(!0).get("required",BasicVal.boolean(!1)),null!=e){var t=i.validator.get("exists",BasicVal.boolean(!1));null!=t&&(existsFilter=t?1:2)}}function ValidationRule(){}fieldval_rules_extend(TextRuleField,RuleField),TextRuleField.prototype.create_ui=function(e){var r=this;TextField&&e.add_field(r.name,new TextField(r.display_name||r.name,r.json))},TextRuleField.prototype.init=function(){var e=this;return e.min_length=e.validator.get("min_length",BasicVal.integer(!1)),null!=e.min_length&&(e.for_search?fieldErrors.getOrMakeInvalid().put("min_length",new ValidatorError(57).error):e.min_length<1&&fieldErrors.getOrMakeInvalid().put("min_length",new ValidatorError(24).error)),e.max_length=e.validator.get("max_length",BasicVal.integer(!1)),null!=e.max_length&&(e.for_search?fieldErrors.getOrMakeInvalid().put("max_length",new ValidatorError(57).error):e.max_length<1&&fieldErrors.getOrMakeInvalid().put("max_length",new ValidatorError(24).error)),e.phrase=e.validator.get("phrase",BasicVal.string(!1)),null!=e.phrase&&(for_search||fieldErrors.getOrMakeInvalid().put("phrase",new ValidatorError(65).error)),e.equal_to=e.validator.get("equal_to",BasicVal.string(!1)),null!=e.equal_to&&(for_search||fieldErrors.getOrMakeInvalid().put("equal_to",new ValidatorError(65).error)),e.ci_equal_to=e.validator.get("ci_equal_to",BasicVal.string(!1)),null!=e.ci_equal_to&&(for_search||fieldErrors.getOrMakeInvalid().put("ci_equal_to",new ValidatorError(65).error)),e.prefix=e.validator.get("prefix",BasicVal.string(!1)),null!=e.prefix&&(for_search||fieldErrors.getOrMakeInvalid().put("prefix",new ValidatorError(65).error)),e.ci_prefix=e.validator.get("ci_prefix",BasicVal.string(!1)),null!=e.ci_prefix&&(for_search||fieldErrors.getOrMakeInvalid().put("ci_prefix",new ValidatorError(65).error)),e.query=e.validator.get("query",BasicVal.string(!1)),null!=e.query&&(for_search||fieldErrors.getOrMakeInvalid().put("query",new ValidatorError(65).error)),e.validator.end()},TextRuleField.prototype.create_operators=function(){var e=this;e.operators.push(BasicVal.string(e.required)),e.min_length&&e.operators.push(BasicVal.min_length(e.min_length,{stop_on_error:!1})),e.max_length&&e.operators.push(BasicVal.max_length(e.max_length,{stop_on_error:!1}))},fieldval_rules_extend(NumberRuleField,RuleField),NumberRuleField.prototype.create_ui=function(e){var r=this;TextField&&e.add_field(r.name,new TextField(r.display_name||r.name,r.json))},NumberRuleField.prototype.init=function(){var e=this;return e.minimum=e.validator.get("minimum",BasicVal.number(!1)),null!=e.minimum,e.maximum=e.validator.get("maximum",BasicVal.number(!1)),null!=e.maximum,e.integer=e.validator.get("integer",BasicVal.boolean(!1)),e.validator.end()},NumberRuleField.prototype.create_operators=function(){var e=this;e.operators.push(BasicVal.number(e.required)),e.minimum&&e.operators.push(BasicVal.minimum(e.minimum,{stop_on_error:!1})),e.maximum&&e.operators.push(BasicVal.maximum(e.maximum,{stop_on_error:!1})),e.integer&&e.operators.push(BasicVal.integer(!1,{stop_on_error:!1}))},fieldval_rules_extend(NestedRuleField,RuleField),NestedRuleField.prototype.create_ui=function(e,r){var i=this;if(ObjectField){var t;t=r?r:new ObjectField(i.display_name||i.name,i.json);for(var a in i.fields){var l=i.fields[a];l.create_ui(t)}r||e.add_field(i.name,t)}},NestedRuleField.prototype.init=function(){var e=this;e.fields={};var r=e.validator.get("fields",BasicVal.object(!1));if(null!=r){var i=new Validator(null);for(var t in r){var a=r[t];a.name||(a.name=t);var l=RuleField.create_field(a),o=l[0],n=l[1];null!=o&&i.invalid(t,o),e.fields[t]=n}var d=i.end();null!=d&&e.validator.invalid("fields",d)}return e.validator.end()},NestedRuleField.prototype.create_operators=function(){var e=this;e.operators.push(BasicVal.object(e.required)),e.operators.push(function(r){var i=new Validator(r);for(var t in e.fields){var a=e.fields[t];a.validate_as_field(t,i)}var l=i.end();return l})},fieldval_rules_extend(ChoiceRuleField,RuleField),ChoiceRuleField.prototype.create_ui=function(e){var r=this;ChoiceField&&e.add_field(r.name,new ChoiceField(r.display_name||r.name,r.choices,r.json))},ChoiceRuleField.prototype.init=function(){var e=this;return e.choices=e.validator.get("choices",BasicVal.array(!0)),e.validator.end()},ChoiceRuleField.prototype.create_operators=function(){var e=this;e.operators.push(Validator.required(!0)),e.choices&&e.operators.push(BasicVal.one_of(e.choices,{stop_on_error:!1}))},RuleField.types={text:TextRuleField,number:NumberRuleField,nested:NestedRuleField,choice:ChoiceRuleField},RuleField.create_field=function(e){var r=null,i=new Validator(e),t=i.get("type",BasicVal.string(!0),BasicVal.one_of(["nested","text","number","choice"]));if(!t)return[i.end(),null];var a=RuleField.types[t];r=new a(e,i);var l=r.init();return null!=l?[l,null]:(r.create_operators(),[null,r])},RuleField.prototype.validate_as_field=function(e,r){var i=this,t=r.get(e,i.operators);return t},RuleField.prototype.validate=function(e){var r=this,i=new Validator(null),e=Validator.use_operators(e,r.operators,i);return i.end()},ValidationRule.prototype.init=function(e){var r=this,i=RuleField.create_field(e);return i[0]?i[0]:void(r.field=i[1])},ValidationRule.prototype.create_form=function(){var e=this;if(Form){var r=new Form;return e.field.create_ui(r,r),r}},ValidationRule.prototype.validate=function(e){var r=this,i=r.field.validate(e);return i},"undefined"!=typeof module&&(module.exports=ValidationRule);