function fieldval_rules_extend(e,i){function l(){}l.prototype=i.prototype,e.prototype=new l,e.prototype.constructor=e,e.superConstructor=i,e.superClass=i.prototype}function TextRuleField(e,i){TextRuleField.superConstructor.call(this,e,i)}function NumberRuleField(e,i){NumberRuleField.superConstructor.call(this,e,i)}function NestedRuleField(e,i){NestedRuleField.superConstructor.call(this,e,i)}function ChoiceRuleField(e,i){ChoiceRuleField.superConstructor.call(this,e,i)}function RuleField(e,i){var l=this;if(l.json=e,l.checks=[],l.validator="undefined"!=typeof i?i:new FieldVal(e),l.name=l.validator.get("name",BasicVal.string(!1)),l.display_name=l.validator.get("display_name",BasicVal.string(!1)),l.description=l.validator.get("description",BasicVal.string(!1)),l.type=l.validator.get("type",BasicVal.string(!0)),l.required=l.validator.default(!0).get("required",BasicVal.boolean(!1)),null!=e){var t=l.validator.get("exists",BasicVal.boolean(!1));null!=t&&(existsFilter=t?1:2)}}function ValidationRule(){}"function"==typeof require&&(FieldVal=require("fieldval"),BasicVal=require("fieldval-basicval")),fieldval_rules_extend(TextRuleField,RuleField),TextRuleField.prototype.create_ui=function(e){var i=this;TextField&&e.add_field(i.name,new TextField(i.display_name||i.name,i.json))},TextRuleField.prototype.init=function(){var e=this;return e.min_length=e.validator.get("min_length",BasicVal.integer(!1)),e.max_length=e.validator.get("max_length",BasicVal.integer(!1)),e.phrase=e.validator.get("phrase",BasicVal.string(!1)),e.equal_to=e.validator.get("equal_to",BasicVal.string(!1)),e.ci_equal_to=e.validator.get("ci_equal_to",BasicVal.string(!1)),e.prefix=e.validator.get("prefix",BasicVal.string(!1)),e.ci_prefix=e.validator.get("ci_prefix",BasicVal.string(!1)),e.query=e.validator.get("query",BasicVal.string(!1)),e.validator.end()},TextRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.string(e.required)),e.min_length&&e.checks.push(BasicVal.min_length(e.min_length,{stop_on_error:!1})),e.max_length&&e.checks.push(BasicVal.max_length(e.max_length,{stop_on_error:!1}))},fieldval_rules_extend(NumberRuleField,RuleField),NumberRuleField.prototype.create_ui=function(e){var i=this;TextField&&e.add_field(i.name,new TextField(i.display_name||i.name,i.json))},NumberRuleField.prototype.init=function(){var e=this;return e.minimum=e.validator.get("minimum",BasicVal.number(!1)),null!=e.minimum,e.maximum=e.validator.get("maximum",BasicVal.number(!1)),null!=e.maximum,e.integer=e.validator.get("integer",BasicVal.boolean(!1)),e.validator.end()},NumberRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.number(e.required)),e.minimum&&e.checks.push(BasicVal.minimum(e.minimum,{stop_on_error:!1})),e.maximum&&e.checks.push(BasicVal.maximum(e.maximum,{stop_on_error:!1})),e.integer&&e.checks.push(BasicVal.integer(!1,{stop_on_error:!1}))},fieldval_rules_extend(NestedRuleField,RuleField),NestedRuleField.prototype.create_ui=function(e,i){var l=this;if(ObjectField){var t;t=i?i:new ObjectField(l.display_name||l.name,l.json);for(var a in l.fields){var r=l.fields[a];r.create_ui(t)}i||e.add_field(l.name,t)}},NestedRuleField.prototype.init=function(){var e=this;e.fields={};var i=e.validator.get("fields",BasicVal.object(!1));if(null!=i){var l=new FieldVal(null);for(var t in i){var a=i[t];a.name||(a.name=t);var r=RuleField.create_field(a),n=r[0],o=r[1];null!=n&&l.invalid(t,n),e.fields[t]=o}var u=l.end();null!=u&&e.validator.invalid("fields",u)}return e.validator.end()},NestedRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.object(e.required)),e.checks.push(function(i){var l=new FieldVal(i);for(var t in e.fields){var a=e.fields[t];a.validate_as_field(t,l)}var r=l.end();return r})},fieldval_rules_extend(ChoiceRuleField,RuleField),ChoiceRuleField.prototype.create_ui=function(e){var i=this;ChoiceField&&e.add_field(i.name,new ChoiceField(i.display_name||i.name,i.choices,i.json))},ChoiceRuleField.prototype.init=function(){var e=this;return e.choices=e.validator.get("choices",BasicVal.array(!0)),e.validator.end()},ChoiceRuleField.prototype.create_checks=function(){var e=this;e.checks.push(FieldVal.required(!0)),e.choices&&e.checks.push(BasicVal.one_of(e.choices,{stop_on_error:!1}))},RuleField.types={text:TextRuleField,string:TextRuleField,number:NumberRuleField,nested:NestedRuleField,choice:ChoiceRuleField},RuleField.create_field=function(e){var i=null,l=new FieldVal(e),t=l.get("type",BasicVal.string(!0),BasicVal.one_of(RuleField.types));if(!t)return[l.end(),null];var a=RuleField.types[t];i=new a(e,l);var r=i.init();return null!=r?[r,null]:(i.create_checks(),[null,i])},RuleField.prototype.validate_as_field=function(e,i){var l=this,t=i.get(e,l.checks);return t},RuleField.prototype.validate=function(e){var i=this,l=new FieldVal(null),t=FieldVal.use_checks(e,i.checks);return t&&l.error(t),l.end()},ValidationRule.prototype.init=function(e){var i=this,l=RuleField.create_field(e);return l[0]?l[0]:void(i.field=l[1])},ValidationRule.prototype.create_form=function(){var e=this;if(Form){var i=new Form;return e.field.create_ui(i,i),i}},ValidationRule.prototype.validate=function(e){var i=this,l=i.field.validate(e);return l},"undefined"!=typeof module&&(module.exports=ValidationRule);