function extend(e,i){function l(){}l.prototype=i.prototype,e.prototype=new l,e.prototype.constructor=e,e.superConstructor=i,e.superClass=i.prototype}function FVRuleField(e,i){var l=this;if(l.json=e,l.checks=[],l.validator="undefined"!=typeof i?i:new FieldVal(e),l.name=l.validator.get("name",BasicVal.string(!1)),l.display_name=l.validator.get("display_name",BasicVal.string(!1)),l.description=l.validator.get("description",BasicVal.string(!1)),l.type=l.validator.get("type",BasicVal.string(!0)),l.required=l.validator.get("required",BasicVal["boolean"](!1)),void 0===l.required&&(l.required=!0),null!=e){var t=l.validator.get("exists",BasicVal["boolean"](!1));null!=t&&(existsFilter=t?1:2)}}function FVBasicRuleField(e,i){FVBasicRuleField.superConstructor.call(this,e,i)}function FVTextRuleField(e,i){FVTextRuleField.superConstructor.call(this,e,i)}function FVNumberRuleField(e,i){FVNumberRuleField.superConstructor.call(this,e,i)}function FVObjectRuleField(e,i){FVObjectRuleField.superConstructor.call(this,e,i)}function FVArrayRuleField(e,i){var l=this;FVArrayRuleField.superConstructor.call(this,e,i),l.rules=[],l.fields=[],l.interval=null,l.interval_offsets=[]}function FVChoiceRuleField(e,i){FVChoiceRuleField.superConstructor.call(this,e,i)}function FVBooleanRuleField(e,i){FVBooleanRuleField.superConstructor.call(this,e,i)}function FVEmailRuleField(e,i){FVEmailRuleField.superConstructor.call(this,e,i)}function FVDateRuleField(e,i){FVDateRuleField.superConstructor.call(this,e,i)}function FVRule(){}"undefined"!=typeof module&&(module.exports=extend),FVRuleField.types={},FVRuleField.add_field_type=function(e){FVRuleField.types[e.name]={display_name:e.display_name,"class":e["class"]}},FVRuleField.create_field=function(e,i){var l=null,t=BasicVal.object(!0).check(e);if(t)return[t,null];var r=new FieldVal(e),a=[BasicVal.string(!1)];i&&(void 0!==i.need_name&&i.need_name===!0&&a.push(BasicVal.string(!0)),void 0!==i.allow_dots&&i.allow_dots===!1&&a.push(BasicVal.does_not_contain(["."])),i.existing_names&&a.push(BasicVal.not_one_of(i.existing_names,{error:{error:1e3,error_message:"Name already used"}}))),r.get("name",a);var n=r.get("type",BasicVal.string(!0),BasicVal.one_of(FVRuleField.types));if(!n)return[r.end(),null];var u=FVRuleField.types[n],d=u["class"];l=new d(e,r);var o=l.init();return null!=o?[o,null]:[null,l]},FVRuleField.prototype.validate_as_field=function(e,i){var l=this;i.get_async(e,l.checks)},FVRuleField.prototype.validate=function(e,i){var l=this;if(!i)throw new Error("No callback specified");return FieldVal.use_checks(e,l.checks,{},function(e){i(e)})},FVRuleField.prototype.make_nested=function(){},FVRuleField.prototype.init=function(){},FVRuleField.prototype.remove=function(){},FVRuleField.prototype.view_mode=function(){},FVRuleField.prototype.edit_mode=function(){},FVRuleField.prototype.change_name=function(){},FVRuleField.prototype.disable=function(){},FVRuleField.prototype.enable=function(){},FVRuleField.prototype.focus=function(){},FVRuleField.prototype.blur=function(){},FVRuleField.prototype.val=function(){},"undefined"!=typeof module&&(module.exports=FVRuleField),"function"==typeof require&&(extend=require("extend")),extend(FVBasicRuleField,FVRuleField),FVBasicRuleField.prototype.init=function(){var e=this;return e.ui_field.init.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.remove=function(){var e=this;return e.ui_field.remove.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.in_array=function(){var e=this;return e.ui_field.in_array.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.in_key_value=function(){var e=this;return e.ui_field.in_key_value.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.change_name=function(){var e=this;return e.ui_field.change_name.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.disable=function(){var e=this;return e.ui_field.disable.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.enable=function(){var e=this;return e.ui_field.enable.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.name_val=function(){var e=this;return e.ui_field.name_val.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},FVBasicRuleField.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},"undefined"!=typeof module&&(module.exports=FVBasicRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField")),extend(FVTextRuleField,FVBasicRuleField),FVTextRuleField.prototype.create_ui=function(){var e=this;return e.ui_field=new FVTextField(e.display_name||e.name,{name:e.json.name,display_name:e.json.display_name,type:e.json.ui_type}),e.element=e.ui_field.element,e.ui_field},FVTextRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal.string(e.required)),e.min_length=e.validator.get("min_length",BasicVal.integer(!1)),void 0!==e.min_length&&e.checks.push(BasicVal.min_length(e.min_length,{stop_on_error:!1})),e.max_length=e.validator.get("max_length",BasicVal.integer(!1)),void 0!==e.max_length&&e.checks.push(BasicVal.max_length(e.max_length,{stop_on_error:!1})),e.ui_type=e.validator.get("ui_type",BasicVal.string(!1),BasicVal.one_of(["text","textarea","password"])),e.phrase=e.validator.get("phrase",BasicVal.string(!1)),e.equal_to=e.validator.get("equal_to",BasicVal.string(!1)),e.ci_equal_to=e.validator.get("ci_equal_to",BasicVal.string(!1)),e.prefix=e.validator.get("prefix",BasicVal.string(!1)),e.ci_prefix=e.validator.get("ci_prefix",BasicVal.string(!1)),e.query=e.validator.get("query",BasicVal.string(!1)),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVTextRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField")),extend(FVNumberRuleField,FVBasicRuleField),FVNumberRuleField.prototype.create_ui=function(){var e=this;return e.ui_field=new FVTextField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},FVNumberRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal.number(e.required)),e.minimum=e.validator.get("minimum",BasicVal.number(!1)),null!=e.minimum&&e.checks.push(BasicVal.minimum(e.minimum,{stop_on_error:!1})),e.maximum=e.validator.get("maximum",BasicVal.number(!1)),null!=e.maximum&&e.checks.push(BasicVal.maximum(e.maximum,{stop_on_error:!1})),e.integer=e.validator.get("integer",BasicVal["boolean"](!1)),e.integer&&e.checks.push(BasicVal.integer(!1,{stop_on_error:!1})),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVNumberRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField"),FVRule=require("../FVRule")),extend(FVObjectRuleField,FVBasicRuleField),FVObjectRuleField.prototype.create_ui=function(e,i){var l=this;if(l.any)if(l.field_type){l.ui_field=new FVKeyValueField(l.display_name||l.name,l.json),l.element=l.ui_field.element,l.ui_field.new_field=function(e){return l.new_field(e)};var t=l.ui_field.remove_field;l.ui_field.remove_field=function(e){for(var i=0;i<l.fields.length;i++)l.fields[i]===e&&l.fields.splice(i,1);return t.call(l.ui_field,e)}}else l.ui_field=new FVTextField(l.display_name||l.name,{type:"textarea"}),l.ui_field.val=function(e){var i=this;if(0===arguments.length){var l=i.input.val();if(0===l.length)return null;try{return JSON.parse(l)}catch(t){console.error("FAILED TO PARSE: ",l)}return l}return i.input.val(JSON.stringify(e,null,4)),i},l.element=l.ui_field.element;else{l.ui_field=i?i:new FVObjectField(l.display_name||l.name,l.json);for(var r in l.fields){var a=l.fields[r],n=a.create_ui(l.ui_field);l.ui_field.add_field(a.name,n)}l.element=l.ui_field.element}return l.ui_field},FVObjectRuleField.prototype.new_field=function(){var e=this,i=FVRuleField.create_field(e.field_type.json),l=(i[0],i[1]);return l.create_ui(e.ui_field)},FVObjectRuleField.prototype.init=function(){var e=this;e.checks.push(BasicVal.object(e.required)),e.fields={};var i=e.validator.get("fields",BasicVal.array(!1));if(null!=i){for(var l=new FieldVal(null),t=0;t<i.length;t++){var r=i[t],a=FVRuleField.create_field(r,{need_name:!0,existing_names:e.fields}),n=a[0],u=a[1];null==n?e.fields[u.name]=u:l.invalid(t,n)}var d=l.end();null!=d&&e.validator.invalid("fields",d)}return e.any=e.validator.get("any",BasicVal["boolean"](!1)),e.any||e.checks.push(function(i,l,t){var r=new FieldVal(i);for(var a in e.fields){var n=e.fields[a];n.validate_as_field(a,r)}return r.end(function(e){t(e)})}),e.validator.get("field_type",BasicVal.object(!1),{check:function(){return e.any?void 0:FVRule.errors.field_type_without_any()},stop_on_error:!0},function(i){var l=FVRuleField.create_field(i),t=l[0];return e.field_type=l[1],t?t:void e.checks.push(function(i){var l=new FieldVal(i);for(var t in i)i.hasOwnProperty(t)&&e.field_type.validate_as_field(t,l);return l.end()})}),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVObjectRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField"),FVRule=require("../FVRule")),extend(FVArrayRuleField,FVBasicRuleField),FVArrayRuleField.prototype.create_ui=function(){var e=this;e.ui_field=new FVArrayField(e.display_name||e.name,e.json),e.ui_field.new_field=function(i){return e.new_field(i)};var i=e.ui_field.remove_field;return e.ui_field.remove_field=function(l){for(var t=0;t<e.fields.length;t++)e.fields[t]===l&&e.fields.splice(t,1);return i.call(e.ui_field,l)},e.element=e.ui_field.element,e.ui_field},FVArrayRuleField.prototype.new_field=function(e){var i=this,l=i.rule_for_index(e);return l.create_ui(i.ui_field)},FVArrayRuleField.prototype.rule_for_index=function(e){var i=this,l=i.rules[e];if(!l){{var t=i.rule_json_for_index(e),r=FVRuleField.create_field(t);r[0]}l=r[1],i.rules[e]=l}return l},FVArrayRuleField.prototype.rule_json_for_index=function(e){var i=this,l=i.indices[e];if(!l&&i.interval){var t=e%i.interval;l=i.interval_offsets[t]}return l||(l=i.indices["*"]),l},FVArrayRuleField.integer_regex=/^(\d+)$/,FVArrayRuleField.interval_regex=/^(\d+)n(\+(\d+))?$/,FVArrayRuleField.prototype.init=function(){var e=this;e.checks.push(BasicVal.array(e.required)),e.indices={};var i=e.validator.get("indices",BasicVal.object(!1));if(null!=i){var l=new FieldVal(null);for(var t in i){var r=i[t],a=FVRuleField.create_field(r),n=a[0];if(null==n){var u=t.match(FVArrayRuleField.interval_regex);if(u){var d=u[1],o=u[3]||0;if(e.interval&&d!==e.interval){l.invalid(t,FieldVal.create_error(FVRule.errors.interval_conflict,{},d,e.interval));continue}e.interval=d,e.interval_offsets[o]=r}else{var s=t.match(FVArrayRuleField.integer_regex);if(s){var F=s[1];e.indices[F]=r}else"*"===t?e.indices["*"]=r:l.invalid(t,FieldVal.create_error(FVRule.errors.invalid_indices_format,{}))}}else l.invalid(t,n)}var c=l.end();c&&e.validator.invalid("indices",c)}return e.checks.push(function(i){for(var l=new FieldVal(i),t=0;t<i.length;t++){var r=e.rule_for_index(t);r.validate_as_field(t,l)}var a=l.end();return a}),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVArrayRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField")),extend(FVChoiceRuleField,FVBasicRuleField),FVChoiceRuleField.prototype.create_ui=function(){var e=this;return e.json.choices=e.choices,e.ui_field=new FVChoiceField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},FVChoiceRuleField.prototype.init=function(){var e=this;return e.allow_empty=e.validator.get("allow_empty",BasicVal["boolean"](!1)),e.empty_message=e.validator.get("empty_message",BasicVal.string(!1)),e.choices=e.validator.get("choices",BasicVal.array(!0)),void 0!==e.choices&&e.checks.push(BasicVal.one_of(e.choices,{stop_on_error:!1})),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVChoiceRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField")),extend(FVBooleanRuleField,FVBasicRuleField),FVBooleanRuleField.prototype.create_ui=function(){var e=this;return e.ui_field=new FVBooleanField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},FVBooleanRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal["boolean"](e.required)),e.equal_to=e.validator.get("equal_to",BasicVal["boolean"](!1)),void 0!==e.equal_to&&e.checks.push(BasicVal.equal_to(e.equal_to)),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVBooleanRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField")),extend(FVEmailRuleField,FVBasicRuleField),FVEmailRuleField.prototype.create_ui=function(){var e=this;return e.ui_field=new FVTextField(e.display_name||e.name,e.json),e.element=e.ui_field.element,e.ui_field},FVEmailRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal.string(e.required),BasicVal.email()),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVEmailRuleField),"function"==typeof require&&(extend=require("extend"),FVBasicRuleField=require("./FVBasicRuleField")),extend(FVDateRuleField,FVBasicRuleField),FVDateRuleField.prototype.create_ui=function(){var e=this;return e.ui_field=new FVDateField(e.display_name||e.name,{name:e.json.name,display_name:e.json.display_name,format:e.date_format}),e.element=e.ui_field.element,e.ui_field},FVDateRuleField.prototype.init=function(){var e=this;return e.date_format=e.validator.get("format",BasicVal.string(!0),BasicVal.date_format({emit:FieldVal.DateVal.EMIT_STRING})),void 0!==e.date_format&&e.checks.push(BasicVal.date(e.date_format)),e.validator.end()},"undefined"!=typeof module&&(module.exports=FVDateRuleField),"function"==typeof require&&(FieldVal=require("fieldval"),BasicVal=FieldVal.BasicVal,FVRuleField=require("./fields/FVRuleField")),FVRule.errors={interval_conflict:function(e,i){return{error:501,error_message:"Only one interval can be used.",interval:e,existing:i}},invalid_indices_format:function(){return{error:502,error_message:"Invalid format for an indices rule."}},field_type_without_any:function(){return{error:503,error_message:"field_type can't be used with setting any to true."}}},FVRule.FVRuleField=FVRuleField,FVRule.prototype.init=function(e,i){var l=this,t=FVRuleField.create_field(e,i);return t[0]?t[0]:(l.field=t[1],null)},FVRule.prototype.create_form=function(){var e=this;if(FVForm){var i=new FVForm;return e.field.create_ui(i,i),i}},FVRule.prototype.create_ui=function(){var e=this;return e.field.create_ui()},FVRule.prototype.validate=function(){var e=this;return e.field.validate.apply(e.field,arguments)},FVRule.prototype.check=function(e,i,l){var t=this;t.field.validate(e,function(e){l(e)})},"undefined"!=typeof module&&(module.exports=FVRule),FVRuleField.add_field_type({name:"text",display_name:"Text","class":"undefined"!=typeof FVTextRuleField?FVTextRuleField:require("./fields/FVTextRuleField")}),FVRuleField.add_field_type({name:"string",display_name:"String","class":"undefined"!=typeof FVTextRuleField?FVTextRuleField:require("./fields/FVTextRuleField")}),FVRuleField.add_field_type({name:"boolean",display_name:"Boolean","class":"undefined"!=typeof FVBooleanRuleField?FVBooleanRuleField:require("./fields/FVBooleanRuleField")}),FVRuleField.add_field_type({name:"number",display_name:"Number","class":"undefined"!=typeof FVNumberRuleField?FVNumberRuleField:require("./fields/FVNumberRuleField")}),FVRuleField.add_field_type({name:"object",display_name:"Object","class":"undefined"!=typeof FVObjectRuleField?FVObjectRuleField:require("./fields/FVObjectRuleField")}),FVRuleField.add_field_type({name:"array",display_name:"Array","class":"undefined"!=typeof FVArrayRuleField?FVArrayRuleField:require("./fields/FVArrayRuleField")}),FVRuleField.add_field_type({name:"choice",display_name:"Choice","class":"undefined"!=typeof FVChoiceRuleField?FVChoiceRuleField:require("./fields/FVChoiceRuleField")}),FVRuleField.add_field_type({name:"email",display_name:"Email","class":"undefined"!=typeof FVEmailRuleField?FVEmailRuleField:require("./fields/FVEmailRuleField")}),FVRuleField.add_field_type({name:"date",display_name:"Date","class":"undefined"!=typeof FVDateRuleField?FVDateRuleField:require("./fields/FVDateRuleField")});